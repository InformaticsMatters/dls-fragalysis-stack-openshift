---

- name: Make directories
  file:
    path: "{{ item }}"
    state: directory
  loop:
  - "{{ lookup('env','HOME') }}/{{ github_dir }}"
  - "{{ lookup('env','HOME') }}/bin"

- name: Clone Fragalysis
  git:
    repo: https://github.com/InformaticsMatters/fragalysis
    version: "{{ fragalysis_version }}"
    dest: "{{ lookup('env','HOME') }}/{{ github_dir }}/fragalysis"

- name: Get Fragalysis commit reference
  shell: git log --pretty=format:'%h' -n 1
  args:
    chdir: "{{ lookup('env','HOME') }}/{{ github_dir }}/fragalysis"
  register: fragalysis_commit_result

- name: Set Fragalysis Facts
  set_fact:
    fragalysis_commit_ref: "{{ fragalysis_commit_result.stdout }}"
