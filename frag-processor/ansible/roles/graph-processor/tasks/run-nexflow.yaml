---

- name: Check nextflow
  shell: ps -aef | grep nextflow | grep -v grep
  register: nextflow_result

- name: Run nextflow (nohup)
  shell: >-
    nohup nextflow run graph-from-standard.nf -with-docker busybox
    -executor.queueSize {{ nextflow_queue_size }}
    {{ nextflow_extra_args }}
    -with-report
    -with-trace
    -with-timeline
    </dev/null >/dev/null 2>&1 &
  when: '"nextflow" not in nextflow_result.stdout'

#Â Optionally wait for nextflow, polling at 15-minute intervals...

- name: Wait for nextflow
  shell: grep Success .nextflow.log
  delay: 900
  retries: "{{ nextflow_timeout_minutes | int }}"
  register: result
  until: result.rc == 0
  when: nextflow_wait
