---

- name: Install worker packages
  yum:
    name:
    - epel-release
    - nfs-utils
    - nfs-utils-lib

# We need to be able to resolve between our name and IP
# on the head node. Workers also need to be able to
# locate the head node by name so their hosts files
#Â are also adjusted.

- name: Adjust /etc/hosts
  lineinfile:
    path: /etc/hosts
    regexp: "{{ line }}"
    line: "{{ line }}"
  vars:
    line: "{{ hostvars['localhost']['head_addr'] }} {{ hostvars['localhost']['head_name'] }}"

# Mount NFS share

- name: Enable and restart NFS
  service:
    name: nfs
    enabled: yes
    state: restarted

- name: Create volume mount-point
  file:
    path: "{{ os_volume_mount }}"
    state: directory
    mode: 0777
    owner: root
    group: root

- name: Mount volume
  mount:
    path: "{{ os_volume_mount }}"
    src: "{{ nfs_ip }}:{{ os_volume_mount }}"
    fstype: nfs
    opts: defaults
    passno: '2'
    state: mounted
  vars:
    nfs_ip: "{{ hostvars['localhost']['head_addr'] }}"
