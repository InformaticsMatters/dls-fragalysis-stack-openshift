---

# oc process -f fs-secrets.yaml | oc create -f -
# oc delete secrets --selector template=fs-secrets

kind: Template
apiVersion: v1
metadata:
  name: fs-secrets
  annotations:
    description: The Fragalysis Stack Secrets
    tags: fragalysis,secrets
labels:
  template: fs-secrets

# Secret values (auto-generated where possible)...

parameters:

- name: WEB_NAMESPACE
  value: fragalysis-cicd
- name: WEB_DJANGO_SECRET_KEY
  generate: expression
  from: '[a-zA-Z0-9]{50}'
- name: WEB_DJANGO_SUPERUSER_NAME
  value: 'admin'
- name: WEB_DJANGO_SUPERUSER_PASSWORD
  generate: expression
  from: '[a-zA-Z0-9]{22}'
- name: WEB_DJANGO_SUPERUSER_EMAIL
  value: 'anthony.richard.bradley@gmail.com'

- name: MYSQL_NAMESPACE
  value: fragalysis-cicd
- name: MYSQL_HOST
  value: mysql.fragalysis-cicd.svc
- name: MYSQL_PORT
  value: '3306'
- name: MYSQL_USER
  value: fragalysis
- name: MYSQL_PASSWORD
  generate: expression
  from: '[a-zA-Z0-9]{12}'
- name: MYSQL_DATABASE
  value: frag
- name: MYSQL_ROOT_PASSWORD
  generate: expression
  from: '[a-zA-Z0-9]{12}'
- name: MYSQL_ROOT_HOST
  value: '%'

- name: ISPYB_NAMESPACE
  value: fragalysis-cicd
- name: ISPYB_USER
  required: true
- name: ISPYB_PASSWORD
  required: true
- name: ISPYB_HOST
  value: ispybdbproxy
- name: ISPYB_PORT
  value: '4306'

# Secrets...

objects:

- kind: Secret
  apiVersion: v1
  metadata:
    name: fs-mysql-secrets
    namespace: ${MYSQL_NAMESPACE}
  stringData:
    database: ${MYSQL_DATABASE}
    database-user: ${MYSQL_USER}
    database-password: ${MYSQL_PASSWORD}
    database-root-password: ${MYSQL_ROOT_PASSWORD}
    database-host: ${MYSQL_HOST}
    database-port: ${MYSQL_PORT}
    database-root-host: ${MYSQL_ROOT_HOST}

- kind: Secret
  apiVersion: v1
  metadata:
    name: fs-ispyb-secrets
    namespace: ${MYSQL_NAMESPACE}
  stringData:
    ispyb-user: ${ISPYB_USER}
    ispyb-password: ${ISPYB_PASSWORD}
    ispyb-host: ${ISPYB_HOST}
    ispyb-port: ${ISPYB_PORT}

- kind: Secret
  apiVersion: v1
  metadata:
    name: fs-web-secrets
    namespace: ${WEB_NAMESPACE}
  stringData:
    django-secret-key: ${WEB_DJANGO_SECRET_KEY}
    django-superuser-name: ${WEB_DJANGO_SUPERUSER_NAME}
    django-superuser-password: ${WEB_DJANGO_SUPERUSER_PASSWORD}
    django-superuser-email: ${WEB_DJANGO_SUPERUSER_EMAIL}
